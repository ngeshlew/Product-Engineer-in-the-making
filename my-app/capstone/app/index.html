<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Capstone Chat Demo</title>
	<style>
		body{font-family:sans-serif;max-width:780px;margin:24px auto;padding:0 12px}
		#log{border:1px solid #e5e7eb;border-radius:8px;padding:12px;min-height:220px}
		.msg{margin:8px 0}
		.msg.you{color:#111827}
		.msg.bot{color:#065f46}
		small{color:#6b7280}
	</style>
</head>
<body>
	<h1>Capstone Chat Demo</h1>
	<div id="log"></div>
	<form id="chat">
		<input id="q" placeholder="Ask somethingâ€¦" style="width:70%" />
		<button>Send</button>
	</form>
	<script>
	const log = document.getElementById('log');
	let sessionId = null;
	function append(role, text, citations){
		const div = document.createElement('div');
		div.className = 'msg ' + role;
		div.innerHTML = `<strong>${role==='you'?'You':'Bot'}:</strong> <span class="content"></span>`;
		const span = div.querySelector('.content');
		if (text){
			// Simulate streaming
			let i=0; const t=text; const timer=setInterval(()=>{ span.textContent = t.slice(0, ++i); if(i>=t.length) clearInterval(timer); }, 8);
		}
		if (citations && citations.length){
			const ul = document.createElement('ul');
			ul.innerHTML = citations.map(c=>{
				const rel = c.path.replace(/^.*docs\//,'');
				return `<li><small><a href="/${rel}" target="_blank" rel="noopener">${c.title}</a></small></li>`;
			}).join('');
			div.appendChild(ul);
		}
		log.appendChild(div); log.scrollTop = log.scrollHeight;
	}
	document.getElementById('chat').addEventListener('submit', async (e)=>{
		e.preventDefault();
		const q = document.getElementById('q').value.trim(); if(!q) return;
		append('you', q);
		document.getElementById('q').value = '';
		try{
			const r = await fetch('http://localhost:8080/chat', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({message:q, session_id: sessionId})});
			const j = await r.json();
			sessionId = j.session_id || sessionId;
			append('bot', j.message, j.citations);
		}catch(err){ append('bot', 'Error: '+err.message); }
	});
	</script>
</body>
</html>